---
title: "TQ hydration prefetchingì„ ì„ ì–¸ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ë‚˜?? - ë¯¸í•´ê²°..ğŸ˜¢"
categories:
  - Next
tag: [TanStackQeury, RSC, RCC, Hydration, Prefetching]
---

# TQ hydration prefetchingì„ ì„ ì–¸ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ë‚˜??

Nextì—ì„œ tanstackQeuryì˜ prefetchingì„ ì‚¬ìš©í•˜ë©° ëŠë‚€ ë¶ˆí¸í•¨ê³¼ ì´ë¥¼ ê°œì„ í•´ë³¸ ê²½í—˜ì„ ê³µìœ í•˜ê¸° ìœ„í•´ ì‘ì„±í•´ë´¤ë‹¤.

## ë§Œì•½ Nextì™€ TanstackQueryë¥¼ í•¨ê»˜ ì“°ê¸°ë¡œ í–ˆë‹¤ë©´?

Nextì˜ ìˆ˜ë§ì€ ì¥ì ê³¼ TanstackQueryì˜ ìˆ˜ë§ì€ ì¥ì  ì¤‘ í•¨ê»˜ ì‚¬ìš©í•œë‹¤ë©´ ì¢‹ì€ ì‹œë„ˆì§€ë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ìƒê°í•´ë³´ì.

### Nextë¥¼ ì“°ëŠ” ì¥ì ì´ ë­ì•¼?

Nextì—ì„œ SSRì„ ì‚¬ìš©í–ˆì„ ë•Œì˜ ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ íŒ¨ì¹­í•´ì„œ HTMLì„ ë§Œë“¤ì–´ ë³´ë‚´ì¤„ ìˆ˜ ìˆë‹¤

### TQë¥¼ ì“°ëŠ” ì¥ì ì´ ë­ì•¼?

ë°ì´í„°ë¥¼ ìºì‹±í•´ì£¼ê³ , ë¡œë”©, ì—ëŸ¬ ì²˜ë¦¬ ë“± ë°ì´í„°ë¥¼ ì†ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

### ì´ ë‘˜ì˜ ì¥ì ì„ í•©ì¹˜ë©´ ë­ì•¼

ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ íŒ¨ì¹­í•˜ê³  ìºì‹±í•˜ì—¬ ì†ì‰½ê²Œ ê´€ë¦¬ í•  ìˆ˜ ìˆë‹¤.

## How?

ì´ë¥¼ ìœ„í•´ TanstackQuery ê³µì‹ë¬¸ì„œì—ì„œëŠ” ì„œë²„ì—ì„œ í”„ë¦¬íŒ¨ì¹­í•˜ëŠ” ë°©ë²•ì„ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…í•˜ê³  ìˆë‹¤.

ê³µì‹ ë¬¸ì„œì— ë‚˜ì˜¨ ì˜ˆì‹œì— ë”°ë¥´ë©´ next App routerì—ì„œ ë°ì´í„°ë¥¼ í”„ë¦¬íŒ¨ì¹­í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ í•  ìˆ˜ ìˆë‹¤

1. í”„ë¦¬íŒ¨ì¹­í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ í˜¸ì¶œí•˜ëŠ” ê³³ì—ì„œ ë¨¼ì € ë°ì´í„°ë¥¼ í”„ë¦¬íŒ¨ì¹­í•´ì£¼ê³ 

```tsx
// server component
export default async function PostsPage() {
  const queryClient = new QueryClient();

  await queryClient.prefetchQuery({
    queryKey: ["posts"],
    queryFn: getPosts,
  });

  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      <Posts />
    </HydrationBoundary>
  );
}
```

1. ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ ë‹¤ì‹œ useQueryë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ë‹¤ ì“´ë‹¤ (ì •í™•íˆëŠ” í”„ë¦¬íŒ¨ì¹­ ì´í›„ì´ë‹ˆ ìºì‹œ ê°’ì„ ê°€ì ¸ë‹¤ ì“°ëŠ” ê²ƒì´ë‹¤.)

```tsx
// client component
"use client";

export default function Posts() {
  const { data } = useQuery({ queryKey: ["posts"], queryFn: getPosts });

  // ...
}
```

ë‚˜ëŠ” ì—¬ê¸°ì„œ ë‘ê°€ì§€ ë¶ˆí¸í•œ ì ì„ ëŠê¼ˆë‹¤.

## Problem

### 1. í”„ë¦¬íŒ¨ì¹­ ë°ì´í„°ê°€ í•„ìš”í•œ ê³³ ë§ˆë‹¤ ìƒìœ„ server componentì™€ ì‚¬ìš©í•˜ëŠ” client componetd ì— ê°ê° ë¡œì§ì´ í•„ìš”í•˜ë‹¤ .

ìƒìœ„ `server component`ì—ì„œëŠ” `queryClient`ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ê³ , ë°ì´í„°ë¥¼ `prefetch` í•œ í›„ `dehydreate` í•œ ë°ì´í„°ë¥¼ `state`ì— ë‹´ì€ `HydrationBoundary`ë¥¼ ì„¤ì •í•´ì¤˜ì•¼í•˜ê³ 

ì‚¬ìš©í•˜ëŠ” `client component`ì—ì„œëŠ” `useQuery`ë¥¼ í†µí•´ `prefetch` í•˜ëŠ” `option`ê³¼ ë™ì¼í•œ ê°’ì„ useQueryì— ë„˜ê²¨ì¤˜ ë¶ˆëŸ¬ì˜¨ë‹¤.

â‡’ ì´ê±°ë¥¼ í•˜ë‚˜ì˜ ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ 2ê³³ì— í¼ì ¸ìˆëŠ” ì‘ì—…ì„ í•œ ê³³ìœ¼ë¡œ ëª¨ì„ ìˆ˜ ì—†ì„ê¹Œ?

### 2. queryClientë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ë¹„ìš©ì´ ë°œìƒí•œë‹¤.

ë§Œì•½ ì—¬ëŸ¬ê³³ì—ì„œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ í”„ë¦¬íŒ¨ì¹­ í•œ ì´í›„ì—ë„ ë‹¤ë¥¸ ê³³ì—ì„œ ì“¸ ë•Œ ë˜‘ê°™ì´ `HydrationBoundary` ì„ í•´ì¤˜ì•¼ í•œë‹¤.

ì´ë§ì€ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ë§ˆë‹¤ í”„ë¦¬íŒ¨ì¹­ì„ ì§„í–‰í•˜ê¸° ìœ„í•´ `queryClient`ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•˜ê³ , í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•´ ëª¨ë“  ìºì‹œê°’ì„ ê°±ì‹ í•˜ëŠ” ë¶ˆí•„ìš”í•œ ë¹„ìš©ì´ ë°œìƒí•œë‹¤.

ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” í–‰ë™ì„ ìƒê°í•´ë´¤ë‹¤.

1. ìˆœì‘í•œë‹¤.

   â†’ ê·¸ëƒ¥ í”„ë¦¬íŒ¨ì¹­ í•˜ë©´ì„œ ìƒˆë¡­ê²Œ `queryClient`ë¥¼ ë§Œë“ ë‹¤.

   â†’ ë‹¤ ëœ»ì´ ìˆëŠ”ê²¨~

2. ì‘ìš©í•œë‹¤.

   â†’ `HydrationBoundary` ì„ ì‚¬ìš©í•  ëª¨ë“  í˜ì´ì§€ ìƒë‹¨ì— ë°°ì¹˜í•´ì„œ í•œ ë²ˆë§Œ `queryClient`ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“ ë‹¤.

   â†’ like ì „ì—­ìƒíƒœê´€ë¦¬ì“°~

3. ê°œì„ í•œë‹¤.

   â†’ `queryClient`ë¥¼ ìƒˆë¡­ê²Œ ë§Œë“œëŠ” ëŒ€ì‹  í˜„ì¬ìˆëŠ” `queryClient`ì™€ ë¹„êµí•´ì„œ í”„ë¦¬íŒ¨ì¹­ í•  ë°ì´í„°ë§Œ `queryClient`ì— ì¶”ê°€í•´ì¤€ë‹¤.

   â†’ TK dodoì”¨ë„ ë¬¸ì œë¥¼ ì¸ì‹í•˜ê³  ìˆì—ˆë‹¤

   ![ë„..ë„ì „..!!](/images/2024-02-26-2024-02-26-01/Untitled.png)

   ë„..ë„ì „..!!

## Solution

ì´ë¼ê³  ì ì—ˆì§€ë§Œ ì™„ë²½í•˜ê²Œ í•´ê²° í•œ ê²ƒì€ í•˜ë‚˜ë„ ì—†ë‹¤ã…(~~í—¤í—¤,,,ë‚œ ë§í•˜ëŠ” ê°ìë‹¹ í—¤í—¿~~)

ì•„ë˜ì˜ ê³¼ì •ì€ solution ì´ë¼ê¸°ë³´ë‹¨ solutionì„ ì°¾ëŠ” ê³¼ì •ë“¤ì´ì—ˆë‹¤ã…ã…

### 1. ì‘ì§‘ë„ë¥¼ ì˜¬ë ¤ë³´ì!

ë¨¼ì € ì²«ë²ˆì§¸ ë¬¸ì œë¼ê³  ìƒê°í–ˆë˜ ë‘ ê³³ì—ì„œ ìˆ˜ì •ì„ í•´ì•¼í•˜ëŠ” ì‘ì§‘ë„ ë¶€ë¶„ì˜ ê°œì„ ì„ ìƒê°í•´ë´¤ë‹¤.

**Q1. ì´ê²Œ.. ë¬¸ì œê°€ ë§ì•„?**

ë¨¼ì € Tanstack queryëŠ” SWRë°©ì‹ì„ ë”°ë¥´ê³  ìˆë‹¤(ê°„ë‹¨íˆ ë§í•˜ë©´ ì—†ëŠ”ê²ƒë³´ë‹¨ ì˜¤ë˜ëœê±° ë³´ì—¬ì£¼ëŠ”ê²Œ ë‚«ë‹¤)

ë§Œì•½ í”„ë¦¬íŒ¨ì¹­ê³¼ ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í•œë²ˆì˜ ë¡œì§ìœ¼ë¡œ í•©ì¹œë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì€ ìƒí™©ì„ ìƒê°í•´ë³´ì

> ë§Œì•½ì— í”„ë¦¬íŒ¨ì¹­ í•œ ì´í›„ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ì— ë°ì´í„°ê°€ ë°”ë€ë‹¤ë©´?

ê°€ì¥ ìµœì‹  ë°ì´í„°ë¥¼ ë³´ì—¬ ì¤„ ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ SWRì— ìœ„ë°°ëœë‹¤.

ì¦‰, ìƒˆë¡­ê²Œ ë³€ê²½ë  ìˆ˜ ìˆëŠ” ë°ì´í„°ëŠ” í”„ë¦¬íŒ¨ì¹­ í–ˆë‹¤ê³  í•´ë„ ì‚¬ìš©í•  ë•Œ ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚´ ê°±ì‹ í•˜ëŠ”ê²Œ ë§ë‹¤.

**Q2. ê·¸ëŸ¼ ë¬¸ì œì¸ ê²½ìš°ëŠ”?**

ë§Œì•½ í”„ë¦¬íŒ¨ì¹­ ì´í›„ ë³€ê²½ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¼ë©´?(ë‹¨ í•œ ë²ˆë§Œ ë°›ì•„ì˜¤ë©´ ë˜ëŠ” ë°ì´í„°ë¼ë©´)

ì´ëŸ´ ê²½ìš° ê³µì‹ë¬¸ì„œì˜ ì˜ˆì œë¥¼ ì¡°ê¸ˆ ë³€í˜•í•´ì„œ ê°œì„ í•  ìˆ˜ ìˆë‹¤.

> server component í”„ë¦¬íŒ¨ì¹­í•œ í›„ client componentsì—ì„œëŠ” ìºì‹±ëœ ë°ì´í„°ë¥¼ ì“°ëŠ” ê²ƒì´ë‹¤.

```tsx
"use client";

export default function Posts() {
  const queryClient = useQueryClient();
  const { data } = queryClient.getQueryData(["posts"]);

  // ...
}
```

ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ í”„ë¦¬íŒ¨ì¹­ ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ ë§¤ë²ˆ ë°ì´í„°ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

í•˜ì§€ë§Œ typescriptë¥¼ ì“´ë‹¤ë©´ ë¬¸ì œê°€ ìˆë‹¤.

`queryClient.getQueryData` ë¡œ ë°›ì•„ì˜¨ ë°ì´í„°ëŠ” ìºì‹œëœ ê°’ì˜ íƒ€ì… ì¶”ë¡ ì´ ì•ˆë˜ì–´ íƒ€ì…ì„ ì§ì ‘ ì§€ì •í•´ì¤˜ì•¼ í•œë‹¤.

ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ì‹ì¸ ë°”ë¡œ

> queryOptionsë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

```tsx
// getPostsOptions.ts
export const getPostsOptions = () =>
  queryOptions({ queryKey: ["posts"], queryFn: getPosts });

// server component
export default async function PostsPage() {
  const queryClient = new QueryClient();

  await queryClient.prefetchQuery(getPostsOptions());

  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      <Posts />
    </HydrationBoundary>
  );
}

// client component
("use client");

export default function Posts() {
  const { data } = useQuery(getPostsOptions().queryKey);

  // ...
}
```

v5ì— ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ë©”ì„œë“œë¡œ í€´ë¦¬ì— ë“¤ì–´ê°€ëŠ” `queryOptions` ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### queryOptionsê°€ ë­”ë°?

queryOptionsë„ JSë¡œ ë³¸ë‹¤ë©´ ê·¸ëƒ¥ ê°ì²´ë¥¼ ë¦¬í„´í•´ì¤€ë‹¤.

í•˜ì§€ë§Œ ê·¸ëƒ¥ JS ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒê³¼ queryOptionsë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ ë‹¬ë¼ì§€ëŠ” ì ì€ ë°”ë¡œ **â€˜íƒ€ì…ì„ ì¶”ë¡ â€™** í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ê·¸ ì´ìœ ëŠ” queryOptionsë¥¼ ë³´ë©´

```tsx
// queryOptions.ts

export function queryOptions<
  TQueryFnData = unknown,
  TError = DefaultError,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey
>(
  options: UndefinedInitialDataOptions<TQueryFnData, TError, TData, TQueryKey>
): UndefinedInitialDataOptions<TQueryFnData, TError, TData, TQueryKey> & {
  queryKey: DataTag<TQueryKey, TQueryFnData>;
};

export function queryOptions<
  TQueryFnData = unknown,
  TError = DefaultError,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey
>(
  options: DefinedInitialDataOptions<TQueryFnData, TError, TData, TQueryKey>
): DefinedInitialDataOptions<TQueryFnData, TError, TData, TQueryKey> & {
  queryKey: DataTag<TQueryKey, TQueryFnData>;
};

export function queryOptions(options: unknown) {
  return options;
}
```

ë‹¨ìˆœíˆ options ê°’ì„ ë¦¬í„´í•´ì£¼ì§€ë§Œ ì´ ì•ˆì— `DataTag`ë¥¼ í†µí•´ì„œ íƒ€ì…ì„ ìƒì„±í•´ì¤€ë‹¤.

`DataTag`ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ê¸¸ë˜ ì´ê²Œ ê°€ëŠ¥í• ê¹Œ?

```tsx
// queryClient-MRqjmcRa.d.ts
declare const dataTagSymbol: unique symbol;
type DataTag<TType, TValue> = TType & {
  [dataTagSymbol]: TValue;
};
```

ì´ì™€ê°™ì´ ì œë„¤ë¦­ íƒ€ì…ìœ¼ë¡œ ë°›ì€ TTypeì— ì¶”ê°€ë¡œ ìœ ë‹ˆí¬í•œ ì‹¬ë³¼í‚¤ì˜ valueíƒ€ì…ìœ¼ë¡œ Tvalueë¼ëŠ” ì œë„¤ë¦­ íƒ€ì…ì„ ë„£ì–´ ì¤Œìœ¼ë¡œì¨ ì´ˆê¸° unknown ì´ë˜ íƒ€ì…ì´ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ë©´ ë°ì´í„°ì— ë§ê²Œ íƒ€ì…ì„ ì¶”ë¡ í•´ì£¼ëŠ” ê²ƒì´ë‹¤â€¦!!(ì†”ì§íˆ ì™„ë²½íˆ ì´í•´ëŠ” ì•ˆëë‹¤,,, TSì‹¤ë ¥ì´ìŠˆ,,ã…œ)

ì´ë ‡ê²Œ DataTagë¡œ ë§Œë“¤ì–´ì§„ queryOptionsë¥¼ í†µí•´ getQueryDataë¥¼ í•˜ê²Œ ë˜ë©´

```tsx
// QeuryKey
type QueryKey = ReadonlyArray<unknown>;

// getQueryData
getQueryData
  <TQueryFnData = unknown,
  TTaggedQueryKey extends QueryKey = QueryKey,
  TInferredQueryFnData = TTaggedQueryKey extends DataTag<unknown, infer TaggedValue>
    ? TaggedValue
    : TQueryFnData>
    (queryKey: TTaggedQueryKey): TInferredQueryFnData | undefined;
```

IDEì—ì„œ íƒ€ì…ì„ ë¹„êµí•´ë³´ë©´

![Untitled](/images/2024-02-26-2024-02-26-01/Untitled1.png)

queryOptionsë¡œ í‚¤ê°’ì„ ë„£ì–´ì¤„ ê²½ìš° ìºì‹± ë°ì´í„°ì— ë§ê²Œ íƒ€ì…ì¶”ë¡ ì´ ë˜ì§€ë§Œ

ê·¸ëƒ¥ JS ê°ì²´ë¡œ ë„£ì–´ì¤„ ê²½ìš° unknown íƒ€ì…ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì´ë¥¼ í†µí•´ ë‘ê³³ì—ì„œ ìˆ˜ì •ì„ í•´ì¤˜ì•¼í–ˆë˜ queryOptionsì„ í•œ ê³³ìœ¼ë¡œ ëª¨ìŒìœ¼ë¡œì¨ ìœ ì§€ë³´ìˆ˜ê°€ ì¡°ê¸ˆ ë” í¸í•´ì¡Œë‹¤.
ì•„ì£¼ ê°„ë‹¨í•œ ì½”ë“œì§€ë§Œ íš¨ê³¼ëŠ” ìƒë‹¹í–ˆë‹¤..!!!

â†’ ì–´? ì´ê±°ë¼ë©´â€¦?? [TSë¡œ ë°ì´í„°ë¥¼ ë°›ê¸°ì „ì— ê·¸ ë°ì´í„°ë¡œ íƒ€ì…ì„ ë§Œë“¤ê³  ì‹¶ìœ¼ë©´?? (+ index signature)](https://www.notion.so/TS-index-signature-9a118c43da364ca58f9564fc82764bde?pvs=21) ì—¬ê¸°ì„œë„ as í•´ê²° ê°€ëŠ¥í•˜ì§€ ì•Šì„ê¹Œ..??

### 2. queryClientë¥¼ ë§¤ë²ˆ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜?

ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” í–‰ë™ 1ë²ˆì€ ê·¸ëƒ¥ ê³µì‹ ë¬¸ì„œ ë”°ë¥´ë©´ ë˜ë‹ˆê¹ pass~

2ë²ˆì€ ë¦¬ì•¡íŠ¸ì—ì„œ stateë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì²˜ëŸ¼ ìƒë‹¨ì˜ ê³µí†µë¶€ëª¨ì—ë‹¤ê°€ í”„ë¦¬íŒ¨ì¹­ì„ í•˜ë©´ëœë‹¤.

ì ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°€ì„œâ€¦ ê°œì„  í•  ìˆ˜ ìˆëŠ”ì§€ ë´ë³´ìâ€¦!

ê°œì¸ì ìœ¼ë¡œ ê°œì„ í•´ë³´ê¸° ìœ„í•´ ì—¬ëŸ¬ê°€ì§€ ì‹œë„ë¥¼ í•´ë´¤ë‹¤.

â‡’ ì´ë¬¸ì œëŠ” TQì¸¡ì—ì„œë„ ì¸ì§€í•˜ê³  ìˆëŠ” ë¬¸ì œë¡œ ì´í›„ **_dehydrateNew_**ë¥¼ ì œê³µí•  ì˜ˆì •ì´ë¼ê³ í•œë‹¤
â‡’ ë‚˜..ë‚˜ë„ í•  ìˆ˜ ìˆë‹¤..!! (ë¨¸ë¦¬ë¥¼ ì¥ì–´ì§œë‚´ë´!!!)

1. ë¨¼ì € ê¸°ì¡´ì— ë§Œë“¤ì–´ ë†“ì€ queryClientë¥¼ ì“°ë©´ ì•ˆë˜ë‚˜??

   ì—¬ê¸°ì—ëŠ” ë‘ê°€ì§€ ë¬¸ì œì ì´ ë°œìƒí–ˆë‹¤.

   í”„ë¦¬íŒ¨ì¹­ì„ ìœ„í•´ì„œëŠ” `await`ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° `client component`ì—ì„œëŠ” `async/await`ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

   ```tsx
   'use client';

   ...

   // useQueryClientë¡œ ê¸°ì¡´ì˜ queryClient ì‚¬ìš© -> í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¨ì•¼í•´ì„œ async/awaitì„ ëª»ì”€.
   export async function Test() {
     const queryClient = useQueryClient();
     await queryClient.prefetchQuery({ queryKey: ['prefetching'], queryFn: getPosts });
     const dehydratedState = dehydrate(queryClient);

     return (
       <div className="flex flex-col items-center gap-10">
         <p>TEST</p>
         <HydrationBoundary state={dehydratedState}>
           <Prefetching />
         </HydrationBoundary>
       </div>
     );
   }

   export default Test;
   ```

   ê·¼ë° ì‹ ê¸°í•˜ê²Œë„ í•œ ë²ˆì€ ì‘ë™í•˜ì§€ë§Œ ë‹¤ë¥¸ ê³³ ê°”ë‹¤ì˜¤ë©´ ì—ëŸ¬ë¥¼ ë±‰ëŠ”ë‹¤ (ëª¨ì§•?)

   ì´ê²ƒì„ í”¼í•˜ê¸° ìœ„í•´ ì¦‰ì‹œì‹¤í–‰ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ë´¤ë‹¤.

   ```tsx
   'use client';

   ...

   export  function Test() {
     const queryClient = useQueryClient();
     (async () =>
   		await queryClient.prefetchQuery({ queryKey: ['prefetching'], queryFn: getPosts }))();
     const dehydratedState = dehydrate(queryClient);

     return (
       <div className="flex flex-col items-center gap-10">
         <p>TEST</p>
         <HydrationBoundary state={dehydratedState}>
           <Prefetching />
         </HydrationBoundary>
       </div>
     );
   }

   export default Test;
   ```

   í•˜ì§€ë§Œ ì´ë ‡ê²Œ í•˜ë©´ í”„ë¦¬íŒ¨ì¹­ì´ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤..!!

2. ê·¸ëŸ¬ë©´ nextì˜ ë‚´ì¥ fetchë¡œ í”„ë¦¬íŒ¨ì¹­ í›„ í•œë‹¤ë©´??

---

## ì°¸ê³ 

[ì°¸ê³ ê¸€](https://velog.io/@ckstn0777/Next.js-13%EC%97%90%EC%84%9C-React-Query-SSR-%EC%A0%81%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95)

[hydrationê°œë…](https://www.youtube.com/watch?v=R-BKadZWYnQ)

[hydration ê°œë…2](https://velog.io/@huurray/React-Hydration-%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC)

[TQ : ì„±ëŠ¥ ë° ìš”ì²­ í­í¬](https://tanstack.com/query/latest/docs/framework/react/guides/request-waterfalls)

[TQ : í”„ë¦¬íŒ¨ì¹­ ë° ë¼ìš°í„° í†µí•©](https://tanstack.com/query/latest/docs/framework/react/guides/prefetching)

[TQ : ì„œë²„ ë Œë”ë§ ë° Hydration](https://tanstack.com/query/latest/docs/framework/react/guides/ssr)

[TQ : ê³ ê¸‰ ì„œë²„ ë Œë”ë§](https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr#server-components--nextjs-app-router)

**[TQê°€ í•„ìš”ì—†ì„ ìˆ˜ë„ ìˆë‹¤](https://tkdodo.eu/blog/you-might-not-need-react-query)**
